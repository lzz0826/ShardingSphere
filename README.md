# ShardingSphere
<br /><br />
#### 初期階段：垂直分庫和垂直分表
#### 後期階段：水平分庫和水平分表

<br />

# 垂直拆分
將業務的不同分類，不同的業務劃分到不同的應用。這種拆分往往是根據系統的改造，將原來的功能模組依照更細粒度的拆分成多個弱耦合的服務

## 垂直分庫：
按照業務模塊將數據分散到不同的數據庫中，每個數據庫存儲一個業務模塊的數據。

假設我們有一個外賣系統，包含 商品管理 訂單管理 用戶管理 三個主要業務模塊。我們可以按照業務將數據垂直拆分成三個數據庫：
![image](https://raw.githubusercontent.com/lzz0826/ShardingSphere/main/images/002.webp)
垂直拆分就是要把表按功能模塊劃分到不同數據庫中，如果你的系統是分佈式微服務的架構，那就更好理解了，一般一個微服務對應這一個或多個數據庫。比如電商系統一般都會有用戶中心、訂單、商品等等。用戶中心數據庫存的都是用戶信息相關的，商品數據庫存的都是商品相關的數據，訂單數據庫則是存的訂單相關的。

## 垂直分表：
將一個表中的列按照不同的業務邏輯拆分成多個表，以減少單個表的寬度，提高查詢性能。

設我們有一個用戶表 users，包含用戶的基本信息和詳細信息。為了優化查詢，我們可以將用戶表垂直拆分成兩個表：

![image](https://raw.githubusercontent.com/lzz0826/ShardingSphere/main/images/001.png)
垂直分表是將一張數據表的字段，拆成兩張或兩張以上的數據進行存放。這樣做的目的一個是避免一張表存的字段太多，單條數據的數據量大，不僅會佔用更多的物理內容，還會降低查詢的性能。而且有些字段查詢的不是很頻繁，有些字段查詢的很頻繁，那我們就可以將這查詢頻繁和查詢不頻繁的字段分開存放。這樣就可以避免磁盤進行不必要的IO，提高系統的性能。我們一般都是把查詢頻繁的字段放到主表中，查詢不頻繁且不是很重要的字段放到擴展表中。主表和擴展表是1對1的關係，之間用主鍵進行關聯。

## 垂直分表的優缺點總結如下：
### 優點：

- 解耦業務邏輯： 垂直分表可以將數據按照業務邏輯進行劃分，降低系統的耦合度，使得每張表只需關注特定的業務需求，提升了系統的可維護性和可擴展性。<br />

- 性能優化： 某些情況下，垂直分表可以提升性能。例如，將頻繁訪問的字段（如用戶名、密碼等）與不經常訪問的字段（如地址、電話等）分開存儲，可以減少數據庫查詢的IO消耗。<br />

- 管理與監控： 通過垂直分表，可以更精細地管理和監控數據庫的使用情況。每個表都可以有獨立的索引、統計信息和備份策略，從而更好地優化數據庫的性能和可用性。<br />

- 併發處理改善： 在高併發場景下，垂直分表可以一定程度上減少單表的併發訪問壓力，提升系統的響應速度和併發處理能力。<br />

### 缺點：

- 數據關聯複雜性增加： 垂直分表會導致數據的關聯查詢複雜化，例如，需要通過多個接口或者服務來聚合數據，增加了開發和維護的複雜度。<br />

- 分佈式事務處理困難： 垂直分表可能會增加分佈式事務處理的難度，因為涉及到跨多個表的操作，需要額外的管理和處理。<br />

- 單表數據量問題未解決： 垂直分表雖然解決了部分表結構的問題，但對於單表數據量過大的情況，依然需要考慮水平切分（即按行切分）的策略，這在大數據量或高訪問壓力下仍然是一個挑戰。<br />


## 在水平拆分之前 因該先考慮：

- 缓存优化： 使用缓存可以显著提升系统的性能和响应速度。特别是对于读取频繁但不经常变化的数据，如静态数据或者热点数据，使用缓存可以减少数据库的访问压力。<br />
- 索引优化： 确保数据库表中的关键查询字段都有合适的索引。索引可以加快查询速度并降低数据库的全表扫描次数，从而提高查询效率。需要定期评估和优化索引以适应实际的查询需求和数据变化。。<br />
- SQL 查询优化： 优化数据库查询语句的结构和性能。这包括选择最佳的查询方式、避免使用不必要的连接和子查询、合理利用数据库优化器等。良好的SQL编写实践可以显著改善系统的整体性能。<br />


# 水平拆分
水平拆分通常依据的主要考量是数据的均衡分布和负载均衡

## 庫內分表：
库内分表是在一个数据库中的某张表，数据行数达到了数据库读写性能的瓶颈的时候，将数据平摊到数据表结构一样的数据表中，已达到减少单张表数据，提升数据表读写性能的目的。
![image](https://raw.githubusercontent.com/lzz0826/ShardingSphere/main/images/005.webp)

## 分庫分表：
库内分表只解决了一个库内单张表的压力，但是如果查询的比较频繁的话，库内分表的那个数据库的整体性能还是很容易达到瓶颈。因为一个物理机的CPU、内容、网络IO都是有限的，所以就需要多个库去分担单库的IO压力。
分库分表就是将原先单库分好的数据表，平摊到各个数据库中，目的就是为了减轻单库的IO性能压力
![image](https://raw.githubusercontent.com/lzz0826/ShardingSphere/main/images/006.webp)

## 水平拆分的優缺點總結如下：
### 優點：
- 单表大小可控。<br />
- 天然便于水平扩展，后期如果想对整个分片集群扩容时，只需要添加节点即可，无需对其他分片的数据进行迁移。<br />
- 使用分片字段进行范围查找时，连续分片可快速定位分片进行快速查询，有效避免跨分片查询的问题。<br />
### 缺点：
- 热点数据成为性能瓶颈。连续分片可能存在数据热点，例如按时间字段分片，有些分片存储最近时间段内的数据，可能会被频繁的读写，而有些分片存储的历史数据，则很少被查询。<br />


